<div "container">
  <div class='row justify-content-center'>
    <div class='col-xs-12 col-md-8 col-lg-5'>
      <table class="table table-borderless my-3">
        <tr>
          <th>
            <% if current_member.profile_image.attached? %>
              <%= image_tag current_member.profile_image.variant(combine_options:{gravity: :center, resize:"100x100^", crop:"100x100+0+0"}).processed, class: "rounded-circle" %>
            <% else %>
              <%= image_tag 'no_image.jpg', class: "rounded-circle", size: '100x100' %>
            <% end %>
          </th>
          <td class='h4 pt-5'><%= current_member.nickname %></td>
          <td class='pt-5 text-nowrap'>
            <%= link_to "変更",edit_member_path(current_member), class: 'btn btn-outline-dark'%>
          </td>
        </tr>
        <tr class='text-muted'>
          <td colspan="3"><i class="far fa-calendar-alt"></i> <%= l current_member.created_at, format: :short %>からVSPPを利用しています</td>
        </tr>
        <tr class="text-center">
          <td><%= link_to current_member.followings.count, member_followings_path(current_member) %><br>フォロー中</td>
    	    <td><%= link_to current_member.followers.count, member_followers_path(current_member) %><br>フォロワー</td>
    	    <td>
              <% if current_member.musical_piece_comments.present? %>
                <%= current_member.musical_piece_comments.count %><br>
              <% else %>
                0<br>
              <% end %>
              投稿数
  	      </td>
  	    </tr>
      </table>
      <!---------------->
      <!--カレンダー---->
      <!---------------->
      <%= month_calendar(events: @musical_piece_comments) do |date, musical_piece_comments| %>
        <%= date.day %><br>
        <% if musical_piece_comments.count != 0 %>
          <% if musical_piece_comments.count == 1 %>
            <div class='calendar-text-mini bg-kusa1 pl-1'>
              <i class="far fa-comment"></i> レビュー <%= musical_piece_comments.count %> 件
            </div>
          <% elsif musical_piece_comments.count == 2 %>
            <div class='calendar-text-mini bg-kusa2 pl-1'>
              <i class="far fa-comments"></i> レビュー <%= musical_piece_comments.count %> 件
            </div>
          <% else %>
            <div class='calendar-text-mini bg-kusa3 text-white pl-1'>
              <i class="far fa-comments"></i> レビュー <%= musical_piece_comments.count %> 件
            </div>
          <% end %>
          <% musical_piece_comments.each do |musical_piece_comment| %>
            <div>
              <%#= musical_piece_comment.comment %>
            </div>
          <% end %>
        <% end %>
  		<% end %>
    </div>
    <!---------------->
    <!--コメント一覧-->
    <!---------------->
    <div class='col-xs-12 col-md-10 col-lg-6'>
      <% if current_member.musical_piece_comments.present? %>
        <table class='table table-borderless table-hover'>
          <% musical_piece_comments = current_member.musical_piece_comments.order(created_at: :desc).limit(100) %>
          <% musical_piece_comments.each do |mc| %>
            <tr>
              <div class='col-xs-1 col-md-2 col-lg-1 text-right'>
                <th>
                  <%= link_to member_path(mc.member) do %>
                    <% if mc.member.profile_image.attached? %>
                      <%= image_tag mc.member.profile_image.variant(combine_options:{gravity: :center, resize:"50x50^", crop:"50x50+0+0"}).processed, class: "rounded-circle" %>
                    <% else %>
                      <%= image_tag 'no_image.jpg', class: "rounded-circle", size: '50x50' %>
                    <% end %>
                  <% end %>
                </th>
              </div>
              <div class='col-xs-11 col-md-8 col-lg-5'>
                <td>
                  <span class='lead'><%= mc.member.nickname %> </span>
                  <span class='text-muted'><%= l mc.created_at, format: :default %></span>
                  <br>
                  <span class='text-muted'>[<%= mc.musical_piece.composer.name_kana %>]</span>
                  <%= link_to musical_piece_path(mc.musical_piece), class: 'text-dark' do %>
                    <%= mc.musical_piece.musical_piece_name %>
                  <% end %>
                  <div class="musical_piece-evaluation text-nowrap" data-score="<%= mc.evaluation %>"></div>
                  <div class="h5 text-break"><%= mc.comment %></div>
                </td>
              </div>
            </tr>
          <% end %>
        </table>
        <script>
          $('.musical_piece-evaluation').empty();//これを入れないとブラウザバックする度に空の星が5つ増えてしまう
          $('.musical_piece-evaluation').raty({
              size: 36,
              starOff:  '<%= asset_path('star-off.png') %>',
              starOn : '<%= asset_path('star-on.png') %>',
              starHalf: '<%= asset_path('star-half.png') %>',
              readOnly: true,
              // ★の半分の入力を行う
              half: true
          });
        </script>
      <% else %>
        <h5 class='mt-3'><%= current_member.nickname %>さんはまだレビュー投稿していません</h4>
      <% end %>
    </div>
  </div>
</div>